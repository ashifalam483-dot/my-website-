<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Resume Builder — Clean & Polished</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Poppins:wght@500;700&display=swap" rel="stylesheet">

  <style>
    /* =================== Theme variables =================== */
    :root{
      --bg: #f4f7fb;
      --card: #ffffff;
      --muted: #64748b;
      --text: #0f172a;
      --accent: #2563eb; /* user requested blue */
      --accent-600: #1e56d7;
      --glass: rgba(255,255,255,0.6);
      --shadow-lg: 0 10px 30px rgba(16,24,40,0.08);
      --radius: 12px;
      --font-sans: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      --font-display: "Poppins", var(--font-sans);
      --toast-bg: rgba(15,23,42,0.92);
      --progress-bg: #e6eefc;
      --progress-fill: linear-gradient(90deg,var(--accent),#60a5fa);
    }

    /* Dark mode overrides */
    :root[data-theme="dark"]{
      --bg: #0b1220;
      --card: #0f1724;
      --muted: #94a3b8;
      --text: #e6eef8;
      --glass: rgba(255,255,255,0.03);
      --shadow-lg: 0 10px 30px rgba(2,6,23,0.6);
      --toast-bg: rgba(255,255,255,0.08);
      --progress-bg: #0b1530;
      --progress-fill: linear-gradient(90deg,var(--accent),#1e90ff);
    }

    /* =================== Reset & base =================== */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:var(--font-sans); background:linear-gradient(180deg,var(--bg), #ffffff00);
      color:var(--text); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      -webkit-tap-highlight-color: transparent;
    }

    /* =================== Container =================== */
    .wrap{max-width:1180px;margin:28px auto;padding:18px}
    header.appbar{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px}
    .branding{display:flex;align-items:center;gap:12px}
    .logoMark{width:54px;height:54px;border-radius:14px;display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-family:var(--font-display); background:linear-gradient(135deg,var(--accent),#60a5fa);box-shadow:var(--shadow-lg)}
    .appTitle{line-height:1}
    .appTitle h1{margin:0;font-size:18px;font-weight:700;font-family:var(--font-display)}
    .appTitle p{margin:0;font-size:12px;color:var(--muted)}

    /* right controls */
    .controlsTop{display:flex;align-items:center;gap:10px}
    .select, .iconBtn, .btn {
      background:var(--card); border:1px solid rgba(15,23,42,0.06); padding:8px 12px;border-radius:10px;cursor:pointer;box-shadow:var(--shadow-lg);
      font-weight:600;font-size:13px;color:var(--text);
    }
    .btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent-600)); color:white;border:none;box-shadow:0 8px 24px rgba(37,99,235,0.18)}
    .iconBtn{display:inline-grid;place-items:center;padding:8px;border-radius:10px;width:44px;height:44px}
    .iconBtn svg{width:18px;height:18px;opacity:0.9}

    /* =================== Layout main =================== */
    .main{display:grid;grid-template-columns:1fr 420px;gap:18px}
    @media (max-width:1000px){ .main{grid-template-columns:1fr; } .rightCol{order:-1} }

    /* left editor */
    .panel{background:var(--card);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow-lg);height:calc(100vh - 160px);overflow:auto}
    .panel .sectionHead{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    .muted{color:var(--muted);font-size:13px}
    .field{margin-bottom:12px}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type="text"], input[type="email"], textarea, select {
      width:100%; padding:11px;border-radius:10px;border:1px solid rgba(15,23,42,0.06);background:transparent;font-size:14px;color:var(--text);
    }
    textarea{min-height:88px;resize:vertical}

    .twoCols{display:flex;gap:10px}
    .twoCols > *{flex:1}

    /* card inside left column for grouping */
    .group{background:linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.3)); border-radius:10px;padding:12px;margin-bottom:12px; border:1px solid rgba(15,23,42,0.04);}
    :root[data-theme="dark"] .group{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01))}

    /* sections list (draggable) */
    .sectionCard{border-radius:10px;padding:10px;border:1px solid rgba(15,23,42,0.04);margin-bottom:10px;background:var(--card)}
    .sectionCard .actions{display:flex;gap:8px}

    /* skill chips */
    .chip{display:inline-flex;align-items:center;padding:6px 10px;border-radius:999px;border:1px solid rgba(15,23,42,0.06);margin:6px 8px 6px 0;font-size:13px;background:linear-gradient(180deg,#fff,#fbfdff)}
    :root[data-theme="dark"] .chip{background:transparent;border:1px solid rgba(255,255,255,0.03)}

    /* bottom sticky controls */
    .stickyControls{position:sticky;bottom:14px;background:transparent;padding-top:10px;display:flex;gap:10px;align-items:center}
    .spacer{flex:1}

    /* right preview column */
    .rightColWrap{position:relative}
    #previewWrap{background:transparent;padding:8px}
    .previewCard{background:var(--card);border-radius:14px;padding:20px;box-shadow:var(--shadow-lg);height:calc(100vh - 200px);overflow:auto;border:1px solid rgba(15,23,42,0.03)}
    .resume{max-width:740px;margin:0 auto;font-family:var(--font-sans);color:var(--text);transition:all .18s ease}

    .headRow{display:flex;align-items:center;gap:16px;justify-content:space-between;margin-bottom:12px}
    .avatar{width:96px;height:96px;border-radius:14px;background:#e7f0ff;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:22px;color:var(--accent)}
    :root[data-theme="dark"] .avatar{background:linear-gradient(180deg,#07102a,#02203a);color:var(--muted)}

    .name{font-size:22px;font-weight:700}
    .role{color:var(--accent);font-weight:600}

    .sectionTitle{font-weight:700;margin-top:10px;margin-bottom:8px}
    .bullet{margin-left:16px;margin-bottom:6px}
    .skillRow{display:flex;flex-wrap:wrap;gap:8px}

    /* templates thumbnails */
    .templates{display:flex;gap:10px;align-items:center}
    .tpl{padding:8px;border-radius:10px;border:1px solid transparent;cursor:pointer;min-width:92px;text-align:center}
    .tpl.selected{border-color:var(--accent);box-shadow:0 10px 30px rgba(37,99,235,0.08)}

    /* progress bar */
    .progressWrap{height:10px;background:var(--progress-bg);border-radius:999px;overflow:hidden}
    .progressFill{height:100%;width:0%;background:var(--progress-fill);display:block;transition:width .36s ease}

    /* toast */
    .toast{position:fixed;right:22px;bottom:22px;background:var(--toast-bg);color:white;padding:10px 14px;border-radius:10px;box-shadow:var(--shadow-lg);display:none;font-weight:600}

    /* modal */
    .modalBackdrop{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:none;align-items:center;justify-content:center;padding:18px}
    .modal{width:100%;max-width:760px;background:var(--card);padding:18px;border-radius:12px;box-shadow:var(--shadow-lg)}

    /* small helpers */
    .mutedSmall{color:var(--muted);font-size:13px}
    .btnTiny{padding:6px 8px;border-radius:8px;font-weight:700}
    .hint{font-size:12px;color:var(--muted)}
    .hidden{display:none}

    /* print rules */
    @media print{
      header.appbar, .stickyControls, .controlsTop {display:none}
      .previewCard{box-shadow:none;height:auto}
    }

    /* transitions */
    .fadeIn{animation:fadeIn .28s ease both}
    @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
  </style>
</head>
<body>
  <div class="wrap" id="app">

    <!-- Header -->
    <header class="appbar fadeIn">
      <div class="branding">
        <div class="logoMark">RB</div>
        <div class="appTitle">
          <h1>Resume Builder</h1>
          <p>Clean • Fast • Professional — Blue theme</p>
        </div>
      </div>

      <div class="controlsTop">
        <select id="langSelect" class="select" title="Language">
          <option value="en">English</option>
          <option value="hi">हिन्दी</option>
          <option value="fr">Français</option>
        </select>

        <div class="templates" title="Choose template">
          <div class="tpl selected" data-template="minimal">Minimal</div>
          <div class="tpl" data-template="modern">Modern</div>
          <div class="tpl" data-template="creative">Creative</div>
        </div>

        <button id="toggleTheme" class="iconBtn" title="Toggle dark / light">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>

        <button id="downloadBtn" class="btn primary">Download PDF</button>
      </div>
    </header>

    <!-- Main -->
    <main class="main">
      <!-- LEFT: Editor -->
      <section class="panel leftPanel fadeIn" aria-labelledby="editor">
        <div class="sectionHead">
          <strong style="font-size:16px">Resume Editor</strong>
          <div class="mutedSmall">Live preview updates as you type</div>
        </div>

        <!-- Progress -->
        <div style="margin-bottom:12px">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <div class="mutedSmall">Completion</div>
            <div id="pctText" class="mutedSmall">0%</div>
          </div>
          <div class="progressWrap"><span class="progressFill" id="progressFill"></span></div>
        </div>

        <!-- Personal info -->
        <div class="group">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
            <div style="font-weight:700">Personal Info</div>
            <div class="hint">Name, contact, and photo</div>
          </div>
          <div class="twoCols" style="margin-bottom:8px">
            <div class="field">
              <label id="lbl_name">Full name</label>
              <input id="inp_name" type="text" placeholder="e.g., Izyaan Khan">
            </div>
            <div class="field">
              <label id="lbl_title">Title</label>
              <input id="inp_title" type="text" placeholder="e.g., Frontend Developer">
            </div>
          </div>

          <div class="twoCols" style="margin-bottom:8px">
            <div class="field"><label id="lbl_email">Email</label><input id="inp_email" type="email" placeholder="name@example.com"></div>
            <div class="field"><label id="lbl_phone">Phone</label><input id="inp_phone" type="text" placeholder="+91 9xxxxxxxxx"></div>
          </div>

          <div class="field"><label id="lbl_linkedin">LinkedIn</label><input id="inp_linkedin" type="text" placeholder="linkedin.com/in/yourname"></div>
          <div class="field"><label id="lbl_photo">Profile photo</label><input id="inp_photo" type="file" accept="image/*"></div>
        </div>

        <!-- Summary -->
        <div class="group">
          <div style="display:flex;align-items:center;justify-content:space-between">
            <div style="font-weight:700" id="lbl_summary_title">Summary / About</div>
            <div class="mutedSmall">Tip: 2–3 concise lines</div>
          </div>
          <div style="margin-top:8px" class="field">
            <textarea id="inp_summary" placeholder="Write a short summary about yourself..."></textarea>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
              <div class="hint" id="charCount">0 / 500</div>
              <div style="display:flex;gap:8px">
                <button id="btnGenSummary" class="btn btnTiny">Generate</button>
                <button id="btnAi" class="btn btnTiny">AI Help</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Sections dynamic -->
        <div class="group">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px">
            <div><strong id="lbl_sections">Sections</strong> <div class="hint" style="display:inline-block;margin-left:8px">Add, reorder, or rename</div></div>
            <div>
              <button id="btnAddSection" class="btn">+ Add Section</button>
            </div>
          </div>

          <div id="sectionsWrap" aria-live="polite"></div>
        </div>

        <!-- Sticky actions -->
        <div class="stickyControls">
          <button id="btnSave" class="btn">Save</button>
          <button id="btnExport" class="btn">Export JSON</button>
          <button id="btnUndo" class="btn">Undo</button>
          <button id="btnRedo" class="btn">Redo</button>
          <div class="spacer"></div>
          <button id="btnShare" class="btn">Share Link</button>
          <button id="btnReset" class="btn">Reset</button>
        </div>
      </section>

      <!-- RIGHT: Preview -->
      <aside class="rightColWrap fadeIn">
        <div id="previewWrap">
          <div class="previewCard">
            <div class="resume" id="preview">
              <!-- preview generated by JS -->
            </div>
          </div>
        </div>

        <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
          <div style="flex:1"></div>
          <button id="btnDownload" class="btn primary">Download PDF</button>
        </div>
      </aside>
    </main>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast">Saved</div>

  <!-- AI Modal -->
  <div id="modal" class="modalBackdrop">
    <div class="modal">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
        <div style="font-weight:700">AI Suggestions</div>
        <div style="display:flex;gap:8px">
          <button id="modalClose" class="btn">Close</button>
        </div>
      </div>
      <div class="mutedSmall" style="margin-bottom:8px">This is a mock AI generator (client-side). Replace with backend AI later.</div>
      <textarea id="aiText" style="width:100%;min-height:140px;border-radius:8px;padding:10px;border:1px solid rgba(15,23,42,0.04)"></textarea>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
        <button id="aiInsertSummary" class="btn primary">Insert to Summary</button>
        <button id="aiInsertBullet" class="btn">Insert as Bullet (Experience)</button>
      </div>
    </div>
  </div>

  <!-- =================== Script (all functionality) =================== -->
  <script>
    /**************************************************************************
     * Polished Resume Builder — One-file frontend
     * Includes:
     *  - All features previously requested (no removals)
     *  - Clean styling + dark mode toggle
     *  - Multi-language (en/hi/fr)
     *  - Templates, sections add/remove/rename/reorder, skills, photo
     *  - Live preview, auto-save, export, share link, download via print
     *  - Simple undo/redo, AI modal (mock)
     **************************************************************************/

    /* -------------------- i18n strings -------------------- */
    const i18n = {
      en: {
        name: "Full name", title: "Title", email: "Email", phone: "Phone",
        linkedin: "LinkedIn", photo: "Profile photo", summary: "Summary / About",
        sections: "Sections", addSection: "Add Section", save: "Save",
        download: "Download PDF", export: "Export JSON", aiHelp: "AI Help",
        reset: "Reset", generate: "Generate", skillPlaceholder: "Type a skill and press Enter",
        emptyResume: "Start filling the form to see live preview", sharedCopied: "Share link copied to clipboard",
        saved: "Saved locally"
      },
      hi: {
        name: "पूरा नाम", title: "पदनाम", email: "ईमेल", phone: "फ़ोन",
        linkedin: "LinkedIn", photo: "प्रोफ़ाइल फ़ोटो", summary: "सारांश / परिचय",
        sections: "अनुभाग", addSection: "अनुभाग जोड़ें", save: "सहेजें",
        download: "PDF डाउनलोड", export: "JSON निर्यात", aiHelp: "AI मदद",
        reset: "रीसेट", generate: "उत्पन्न करें", skillPlaceholder: "कौशल लिखें और Enter दबाएँ",
        emptyResume: "लाइव प्रीव्यू देखने के लिए फ़ॉर्म भरना शुरू करें", sharedCopied: "शेयर लिंक क्लिपबोर्ड में कॉपी हुआ",
        saved: "लोकल में सहेजा गया"
      },
      fr: {
        name: "Nom complet", title: "Titre", email: "E-mail", phone: "Téléphone",
        linkedin: "LinkedIn", photo: "Photo de profil", summary: "Résumé / À propos",
        sections: "Sections", addSection: "Ajouter une section", save: "Enregistrer",
        download: "Télécharger PDF", export: "Exporter JSON", aiHelp: "Aide IA",
        reset: "Réinitialiser", generate: "Générer", skillPlaceholder: "Tapez une compétence et appuyez sur Entrée",
        emptyResume: "Commencez à remplir le formulaire pour voir l'aperçu", sharedCopied: "Lien partagé copié"
      }
    };

    /* -------------------- State -------------------- */
    const defaultState = {
      meta: { template: 'minimal', themeColor: '#2563eb', font: 'Inter' },
      personal: { name:'', title:'', email:'', phone:'', linkedin:'', photoData:'' },
      summary: '',
      sections: [
        { id: idGen(), name: 'Experience', type: 'experience', items: [
          { id:idGen(), company:'Company XYZ', role:'Frontend Dev', dates:'2022 - Present', bullets:['Built UI','Improved performance'] }
        ]},
        { id: idGen(), name: 'Education', type: 'education', items: [
          { id:idGen(), school:'ABC University', degree:'Diploma in Software Engg', dates:'2019 - 2022', bullets:[] }
        ]},
        { id: idGen(), name: 'Skills', type: 'skills', items: ['JavaScript','HTML','CSS','React'] }
      ]
    };

    let state = loadState() || JSON.parse(JSON.stringify(defaultState));
    let undoStack = [], redoStack = [];

    /* -------------------- Utils -------------------- */
    function idGen(){ return 'id_' + Math.random().toString(36).slice(2,9) }
    function saveState(pushUndo=true){
      if(pushUndo){ undoStack.push(JSON.stringify(state)); if(undoStack.length>60) undoStack.shift(); }
      localStorage.setItem('rb_state_v2', JSON.stringify(state));
      showToast(t('saved'));
    }
    function loadState(){ try{ return JSON.parse(localStorage.getItem('rb_state_v2')); }catch(e){ return null } }
    function showToast(msg){ const el = document.getElementById('toast'); el.textContent = msg; el.style.display='block'; clearTimeout(el._t); el._t = setTimeout(()=>el.style.display='none',1600); }

    /* -------------------- Elements -------------------- */
    const langSelect = document.getElementById('langSelect');
    const preview = document.getElementById('preview');
    const sectionsWrap = document.getElementById('sectionsWrap');
    const inp_name = document.getElementById('inp_name'), inp_title = document.getElementById('inp_title'),
          inp_email = document.getElementById('inp_email'), inp_phone = document.getElementById('inp_phone'),
          inp_linkedin = document.getElementById('inp_linkedin'), inp_photo = document.getElementById('inp_photo'),
          inp_summary = document.getElementById('inp_summary'), charCount = document.getElementById('charCount'),
          progressFill = document.getElementById('progressFill'), pctText = document.getElementById('pctText');

    /* -------------------- Theme (dark/light) -------------------- */
    const root = document.documentElement;
    const themeToggle = document.getElementById('toggleTheme');
    let theme = localStorage.getItem('rb_theme') || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark':'light');
    function applyTheme(them){
      theme = them;
      if(them === 'dark'){ root.setAttribute('data-theme','dark'); } else { root.removeAttribute('data-theme'); }
      localStorage.setItem('rb_theme', theme);
    }
    themeToggle.addEventListener('click', ()=> applyTheme(theme === 'dark' ? 'light' : 'dark'));
    applyTheme(theme);

    /* -------------------- I18N -------------------- */
    let lang = localStorage.getItem('rb_lang') || 'en';
    langSelect.value = lang;
    function t(k){ return (i18n[lang] && i18n[lang][k]) ? i18n[lang][k] : (i18n['en'][k] || k) }
    function applyLang(){
      lang = langSelect.value; localStorage.setItem('rb_lang', lang);
      document.getElementById('lbl_name').textContent = t('name');
      document.getElementById('lbl_title').textContent = t('title');
      document.getElementById('lbl_email').textContent = t('email');
      document.getElementById('lbl_phone').textContent = t('phone');
      document.getElementById('lbl_linkedin').textContent = t('linkedin');
      document.getElementById('lbl_photo').textContent = t('photo');
      document.getElementById('lbl_summary_title').textContent = t('summary');
      document.getElementById('lbl_sections').textContent = t('sections');
      document.getElementById('btnAddSection').textContent = t('addSection');
      document.getElementById('downloadBtn').textContent = t('download');
    }
    langSelect.addEventListener('change', ()=>{ applyLang(); renderAll(); });
    applyLang();

    /* -------------------- Render functions -------------------- */
    function renderAll(){
      renderForm();
      renderPreview();
      updateProgress();
    }

    function renderForm(){
      // personal fields
      inp_name.value = state.personal.name || '';
      inp_title.value = state.personal.title || '';
      inp_email.value = state.personal.email || '';
      inp_phone.value = state.personal.phone || '';
      inp_linkedin.value = state.personal.linkedin || '';
      inp_summary.value = state.summary || '';
      charCount.textContent = (state.summary||'').length + ' / 500';

      // sections list
      sectionsWrap.innerHTML = '';
      state.sections.forEach((sec, sIdx) => {
        const card = document.createElement('div');
        card.className = 'sectionCard fadeIn';
        card.draggable = true;
        card.dataset.idx = sIdx;
        card.innerHTML = `
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
            <div style="display:flex;flex-direction:column">
              <strong style="font-size:14px">${escapeHtml(sec.name)}</strong>
              <span class="mutedSmall">${sec.type}</span>
            </div>
            <div class="actions">
              <button class="btnTiny editName">Rename</button>
              <button class="btnTiny addItem">+Item</button>
              <button class="btnTiny removeSection">Remove</button>
            </div>
          </div>
        `;
        const content = document.createElement('div');

        // render by type
        if(sec.type === 'skills'){
          const chipRow = document.createElement('div');
          chipRow.className = 'skillRow';
          (sec.items || []).forEach((s, i)=>{
            const chip = document.createElement('span');
            chip.className = 'chip';
            chip.innerHTML = `${escapeHtml(s)} <button style="margin-left:8px;border:none;background:transparent;cursor:pointer">×</button>`;
            chip.querySelector('button').addEventListener('click', ()=>{ saveState(); sec.items.splice(i,1); renderAll(); });
            chipRow.appendChild(chip);
          });
          const input = document.createElement('input');
          input.placeholder = t('skillPlaceholder');
          input.addEventListener('keydown', (e)=>{ if(e.key === 'Enter' && input.value.trim()){ saveState(); sec.items.push(input.value.trim()); input.value=''; renderAll(); }});
          content.appendChild(chipRow); content.appendChild(input);
        } else if(sec.type === 'experience' || sec.type === 'projects' || sec.type === 'education'){
          const list = document.createElement('div');
          (sec.items || []).forEach((it, idx) => {
            const itWrap = document.createElement('div');
            itWrap.style.borderTop = '1px solid rgba(15,23,42,0.04)';
            itWrap.style.padding = '10px 0';

            if(sec.type === 'experience'){
              itWrap.innerHTML = `
                <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
                  <input class="itm-company" placeholder="Company" style="flex:2" value="${escapeHtml(it.company||'')}">
                  <input class="itm-role" placeholder="Role" style="flex:1" value="${escapeHtml(it.role||'')}">
                  <input class="itm-dates" placeholder="Dates" style="flex:.9" value="${escapeHtml(it.dates||'')}">
                  <button class="btnTiny removeItem">Remove</button>
                </div>
                <div class="itm-bullets"></div>
              `;
            } else if(sec.type === 'education'){
              itWrap.innerHTML = `
                <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
                  <input class="itm-school" placeholder="School / College" style="flex:2" value="${escapeHtml(it.school||'')}">
                  <input class="itm-degree" placeholder="Degree" style="flex:1" value="${escapeHtml(it.degree||'')}">
                  <input class="itm-dates" placeholder="Dates" style="flex:.9" value="${escapeHtml(it.dates||'')}">
                  <button class="btnTiny removeItem">Remove</button>
                </div>
              `;
            } else if(sec.type === 'projects'){
              itWrap.innerHTML = `
                <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
                  <input class="itm-project" placeholder="Project" style="flex:2" value="${escapeHtml(it.project||'')}">
                  <input class="itm-link" placeholder="Link (optional)" style="flex:1" value="${escapeHtml(it.link||'')}">
                  <button class="btnTiny removeItem">Remove</button>
                </div>
                <div class="itm-bullets"></div>
              `;
            }

            // bullets if present
            if(it.bullets !== undefined){
              const bulletsDiv = document.createElement('div');
              (it.bullets || []).forEach((b, bi)=>{
                const row = document.createElement('div');
                row.style.display='flex';row.style.gap='8px';row.style.marginBottom='6px';row.style.alignItems='center';
                const inp = document.createElement('input'); inp.value = b; inp.style.flex='1';
                inp.addEventListener('input', ()=>{ it.bullets[bi] = inp.value; saveState(false); renderPreview(); });
                const rm = document.createElement('button'); rm.className='btnTiny'; rm.textContent='Remove';
                rm.addEventListener('click', ()=>{ saveState(); it.bullets.splice(bi,1); renderAll(); });
                row.appendChild(inp); row.appendChild(rm);
                bulletsDiv.appendChild(row);
              });
              const addRow = document.createElement('div'); addRow.style.display='flex';addRow.style.gap='8px';
              const addInp = document.createElement('input'); addInp.placeholder='Add bullet';
              const addBtn = document.createElement('button'); addBtn.className='btnTiny'; addBtn.textContent='Add';
              addBtn.addEventListener('click', ()=>{ if(addInp.value.trim()){ saveState(); it.bullets.push(addInp.value.trim()); renderAll(); }});
              addRow.appendChild(addInp); addRow.appendChild(addBtn);
              itWrap.querySelector('.itm-bullets').appendChild(bulletsDiv); itWrap.querySelector('.itm-bullets').appendChild(addRow);
            }

            // remove item
            itWrap.querySelectorAll('.removeItem').forEach(b=> b.addEventListener('click', ()=>{
              if(confirm('Remove item?')){ saveState(); sec.items.splice(idx,1); renderAll(); }
            }));

            // wire basic inputs to state
            itWrap.querySelectorAll('input').forEach(inp=>{
              inp.addEventListener('input', ()=> {
                if(sec.type === 'experience'){
                  it.company = itWrap.querySelector('.itm-company')?.value || it.company;
                  it.role = itWrap.querySelector('.itm-role')?.value || it.role;
                  it.dates = itWrap.querySelector('.itm-dates')?.value || it.dates;
                } else if(sec.type === 'education'){
                  it.school = itWrap.querySelector('.itm-school')?.value || it.school;
                  it.degree = itWrap.querySelector('.itm-degree')?.value || it.degree;
                  it.dates = itWrap.querySelector('.itm-dates')?.value || it.dates;
                } else if(sec.type === 'projects'){
                  it.project = itWrap.querySelector('.itm-project')?.value || it.project;
                  it.link = itWrap.querySelector('.itm-link')?.value || it.link;
                }
                saveState(false); renderPreview();
              });
            });

            list.appendChild(itWrap);
          });

          content.appendChild(list);
        } else {
          content.innerHTML = '<div class="mutedSmall">No items</div>';
        }

        card.appendChild(content);
        sectionsWrap.appendChild(card);

        // actions
        card.querySelector('.editName').addEventListener('click', ()=> {
          const newName = prompt('Rename section', sec.name);
          if(newName){ saveState(); sec.name = newName; renderAll(); }
        });
        card.querySelector('.addItem').addEventListener('click', ()=> {
          saveState();
          if(sec.type === 'skills'){ sec.items.push('New skill'); }
          else if(sec.type === 'experience'){ sec.items.push({ id:idGen(), company:'New Company', role:'Role', dates:'', bullets:[] }); }
          else if(sec.type === 'education'){ sec.items.push({ id:idGen(), school:'New School', degree:'Degree', dates:'' }); }
          else if(sec.type === 'projects'){ sec.items.push({ id:idGen(), project:'New Project', link:'', bullets:[] }); }
          renderAll();
        });
        card.querySelector('.removeSection').addEventListener('click', ()=> {
          if(confirm('Remove section "'+sec.name+'" ?')){ saveState(); state.sections.splice(sIdx,1); renderAll(); }
        });

        // drag/drop reorder
        card.addEventListener('dragstart', e=> { card.classList.add('dragging'); e.dataTransfer.setData('text/plain', sIdx); });
        card.addEventListener('dragend', ()=> card.classList.remove('dragging'));
        card.addEventListener('dragover', e=> e.preventDefault());
        card.addEventListener('drop', e=>{
          e.preventDefault();
          const from = parseInt(e.dataTransfer.getData('text/plain'));
          const to = parseInt(card.dataset.idx);
          if(from === to) return;
          saveState();
          const item = state.sections.splice(from,1)[0];
          state.sections.splice(to,0,item);
          renderAll();
        });
      });
    }

    function renderPreview(){
      const p = state.personal;
      const tpl = state.meta.template || 'minimal';
      let html = '';
      html += `<div class="headRow"><div style="display:flex;gap:14px;align-items:center">`;
      if(p.photoData){
        html += `<div class="avatar"><img src="${p.photoData}" style="width:96px;height:96px;border-radius:12px;object-fit:cover"></div>`;
      } else {
        const initials = ((p.name||'').split(' ').map(s=>s[0]).slice(0,2).join('')||'RB').toUpperCase();
        html += `<div class="avatar">${initials}</div>`;
      }
      html += `<div><div class="name">${escapeHtml(p.name || 'Your Name')}</div><div class="role">${escapeHtml(p.title || 'Your Title')}</div>`;
      html += `<div class="mutedSmall" style="margin-top:6px">${escapeHtml(p.email||'')} ${p.email ? ' • ' : ''}${escapeHtml(p.phone||'')}</div></div></div></div>`;

      if(state.summary){
        html += `<div><div class="sectionTitle">Summary</div><div class="mutedSmall">${escapeHtml(state.summary)}</div></div>`;
      }

      state.sections.forEach(sec=>{
        html += `<div><div class="sectionTitle">${escapeHtml(sec.name)}</div>`;
        if(sec.type === 'skills'){
          html += `<div class="skillRow">`; (sec.items||[]).forEach(s => html += `<div class="chip">${escapeHtml(s)}</div>`); html += `</div>`;
        } else {
          (sec.items||[]).forEach(it=>{
            if(sec.type === 'experience'){
              html += `<div style="margin-bottom:10px"><div style="display:flex;justify-content:space-between"><div style="font-weight:600">${escapeHtml(it.role||'')}<span class="mutedSmall"> — ${escapeHtml(it.company||'')}</span></div><div class="mutedSmall">${escapeHtml(it.dates||'')}</div></div>`;
              if(it.bullets && it.bullets.length){ html += `<ul style="margin-top:6px">`; it.bullets.forEach(b=> html += `<li class="bullet">${escapeHtml(b)}</li>`); html += `</ul>`; }
              html += `</div>`;
            } else if(sec.type === 'education'){
              html += `<div style="margin-bottom:10px"><div style="font-weight:600">${escapeHtml(it.school||'')}</div><div class="mutedSmall">${escapeHtml(it.degree||'')} • ${escapeHtml(it.dates||'')}</div></div>`;
            } else if(sec.type === 'projects'){
              html += `<div style="margin-bottom:10px"><div style="font-weight:600">${escapeHtml(it.project||'')}</div>`;
              if(it.bullets && it.bullets.length){ html += `<ul style="margin-top:6px">`; it.bullets.forEach(b=> html += `<li class="bullet">${escapeHtml(b)}</li>`); html += `</ul>`; }
              html += `</div>`;
            }
          });
        }
        html += `</div>`;
      });

      preview.innerHTML = html;
    }

    function updateProgress(){
      let total = 6, filled = 0;
      if(state.personal.name) filled++;
      if(state.personal.title) filled++;
      if(state.personal.email) filled++;
      if(state.summary) filled++;
      if(state.sections && state.sections.length) filled++;
      if(state.sections.some(s=> s.type==='skills' && s.items && s.items.length>0)) filled++;
      const pct = Math.round((filled/total)*100);
      progressFill.style.width = pct + '%';
      pctText.textContent = pct + '%';
    }

    /* -------------------- Event wiring -------------------- */
    // personal inputs
    [inp_name, inp_title, inp_email, inp_phone, inp_linkedin].forEach(el=>{
      el.addEventListener('input', ()=>{
        state.personal.name = inp_name.value;
        state.personal.title = inp_title.value;
        state.personal.email = inp_email.value;
        state.personal.phone = inp_phone.value;
        state.personal.linkedin = inp_linkedin.value;
        saveState(false); renderPreview(); updateProgress();
      });
    });

    inp_photo.addEventListener('change', (e)=>{
      const file = e.target.files[0]; if(!file) return;
      const reader = new FileReader();
      reader.onload = ev => { saveState(); state.personal.photoData = ev.target.result; renderPreview(); }
      reader.readAsDataURL(file);
    });

    inp_summary.addEventListener('input', ()=>{
      state.summary = inp_summary.value.slice(0,500);
      charCount.textContent = state.summary.length + ' / 500';
      saveState(false); renderPreview(); updateProgress();
    });

    // templates selector
    document.querySelectorAll('.tpl').forEach(el=>{
      el.addEventListener('click', ()=>{
        document.querySelectorAll('.tpl').forEach(x=>x.classList.remove('selected'));
        el.classList.add('selected');
        state.meta.template = el.dataset.template;
        saveState(); renderPreview();
      });
    });

    // add section
    document.getElementById('btnAddSection').addEventListener('click', ()=>{
      const name = prompt('Section name (e.g., Volunteer, Awards, Languages)', 'New Section');
      if(!name) return;
      const type = prompt('Type (skills/experience/education/projects/custom)', 'custom');
      saveState();
      const t = ['skills','experience','education','projects','custom'].includes(type) ? type : 'custom';
      const sec = { id:idGen(), name, type: t, items: (t==='skills')?[]:[] };
      state.sections.push(sec); renderAll();
    });

    // save / export
    document.getElementById('btnSave').addEventListener('click', ()=> saveState());
    document.getElementById('btnExport').addEventListener('click', ()=>{
      const data = JSON.stringify(state, null, 2);
      const blob = new Blob([data], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'resume.json'; a.click(); URL.revokeObjectURL(url);
    });

    // share link
    document.getElementById('btnShare').addEventListener('click', ()=>{
      const encoded = encodeURIComponent(btoa(unescape(encodeURIComponent(JSON.stringify(state)))));
      const link = location.origin + location.pathname + '#resume=' + encoded;
      copyToClipboard(link); showToast(t('sharedCopied'));
    });

    // load from hash if present
    function tryLoadFromHash(){
      if(location.hash.startsWith('#resume=')){
        try{
          const enc = location.hash.replace('#resume=','');
          const json = decodeURIComponent(escape(atob(decodeURIComponent(enc))));
          const parsed = JSON.parse(json);
          if(parsed){ state = parsed; saveState(false); renderAll(); showToast('Loaded shared resume'); }
        }catch(e){ console.warn('Invalid resume hash'); }
      }
    }
    tryLoadFromHash();

    // download via print
    document.getElementById('downloadBtn').addEventListener('click', ()=> window.print());
    document.getElementById('btnDownload').addEventListener('click', ()=> window.print());

    // reset
    document.getElementById('btnReset').addEventListener('click', ()=>{
      if(confirm('Reset everything and start fresh?')){
        saveState(); state = JSON.parse(JSON.stringify(defaultState)); saveState(); renderAll();
      }
    });

    // AI modal (mock)
    const modal = document.getElementById('modal'), aiText = document.getElementById('aiText');
    document.getElementById('btnAi').addEventListener('click', ()=> {
      aiText.value = generateMockAI(); modal.style.display = 'flex';
    });
    document.getElementById('modalClose').addEventListener('click', ()=> modal.style.display='none');
    document.getElementById('aiInsertSummary').addEventListener('click', ()=> {
      state.summary = aiText.value; inp_summary.value = state.summary; saveState(); renderAll(); modal.style.display='none';
    });
    document.getElementById('aiInsertBullet').addEventListener('click', ()=>{
      let exp = state.sections.find(s=>s.type==='experience');
      saveState();
      if(!exp){ exp = { id:idGen(), name:'Experience', type:'experience', items:[] }; state.sections.unshift(exp); }
      if(!exp.items.length){ exp.items.push({ id:idGen(), company:'', role:'', dates:'', bullets:[] }); }
      exp.items[0].bullets = exp.items[0].bullets || []; exp.items[0].bullets.push(aiText.value);
      saveState(); renderAll(); modal.style.display='none';
    });

    // gen summary quick
    document.getElementById('btnGenSummary').addEventListener('click', ()=>{
      inp_summary.value = generateMockAI(); inp_summary.dispatchEvent(new Event('input'));
    });

    // undo / redo
    document.getElementById('btnUndo').addEventListener('click', ()=>{
      if(undoStack.length){ redoStack.push(JSON.stringify(state)); state = JSON.parse(undoStack.pop()); localStorage.setItem('rb_state_v2', JSON.stringify(state)); renderAll(); showToast('Undo'); }
      else showToast('Nothing to undo');
    });
    document.getElementById('btnRedo').addEventListener('click', ()=>{
      if(redoStack.length){ undoStack.push(JSON.stringify(state)); state = JSON.parse(redoStack.pop()); localStorage.setItem('rb_state_v2', JSON.stringify(state)); renderAll(); showToast('Redo'); }
      else showToast('Nothing to redo');
    });

    // quick keyboard shortcuts
    window.addEventListener('keydown', (e)=>{
      if((e.ctrlKey || e.metaKey) && e.key === 's'){ e.preventDefault(); saveState(); }
      if((e.ctrlKey || e.metaKey) && e.key === 'z'){ e.preventDefault(); document.getElementById('btnUndo').click(); }
      if((e.ctrlKey || e.metaKey) && e.key === 'y'){ e.preventDefault(); document.getElementById('btnRedo').click(); }
    });

    // small helpers
    function copyToClipboard(text){ navigator.clipboard?.writeText(text).catch(()=>{ const ta=document.createElement('textarea'); ta.value=text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); }); }
    function escapeHtml(s){ if(!s) return ''; return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

    // mock AI generator
    function generateMockAI(){
      const name = state.personal.name || 'Talented professional';
      const role = state.personal.title || 'specialist';
      const lines = [
        `${name} is a motivated ${role} with strong problem-solving skills and hands-on experience building user-focused web interfaces.`,
        `Proven ability to improve performance and usability; comfortable with modern frontend stacks and collaborative workflows.`,
        `Skilled in JavaScript, responsive design, and turning product ideas into polished user experiences.`
      ];
      return lines.join(' ');
    }

    // load/save on unload
    window.addEventListener('beforeunload', ()=> saveState(false) );

    // initial bindings
    document.getElementById('btnShare').addEventListener('click', ()=> { /* handled earlier via id */ });
    document.getElementById('btnExport').addEventListener('click', ()=> {/* handled above */});
    document.getElementById('toggleTheme').addEventListener('click', ()=> {/* handled above */});

    // init: apply stored language, theme, render UI
    lang = localStorage.getItem('rb_lang') || 'en'; langSelect.value = lang; applyLang();
    function applyLang(){ applyLangInternal(); renderAll(); }
    function applyLangInternal(){ lang = langSelect.value; localStorage.setItem('rb_lang', lang); document.getElementById('lbl_name').textContent = t('name'); document.getElementById('lbl_title').textContent = t('title'); document.getElementById('lbl_email').textContent = t('email'); document.getElementById('lbl_phone').textContent = t('phone'); document.getElementById('lbl_linkedin').textContent = t('linkedin'); document.getElementById('lbl_photo').textContent = t('photo'); document.getElementById('lbl_summary_title').textContent = t('summary'); document.getElementById('lbl_sections').textContent = t('sections'); document.getElementById('btnAddSection').textContent = t('addSection'); document.getElementById('downloadBtn').textContent = t('download'); }

    // try load saved state or default
    (function init(){
      const loaded = loadState();
      if(loaded) state = loaded; else { state = JSON.parse(JSON.stringify(defaultState)); saveState(false); }
      renderAll();
    })();

    // try load from hash for share link
    (function tryHash(){ if(location.hash.startsWith('#resume=')){ try{ const enc = location.hash.replace('#resume=',''); const json = decodeURIComponent(escape(atob(decodeURIComponent(enc)))); const parsed = JSON.parse(json); if(parsed){ state = parsed; saveState(false); renderAll(); showToast('Loaded shared resume'); } }catch(e){ console.warn('Invalid resume hash'); } } })();

  </script>
  <!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js"></script>

<script>
  // Your Firebase project details
  const firebaseConfig = {
    apiKey: "AIzaSyBoIcJ6p-MlTgZaW6qTV9w3jPdwZvXlFaw",
    authDomain: "resume-builder-2dda8.firebaseapp.com",
    projectId: "resume-builder-2dda8",
    storageBucket: "resume-builder-2dda8.appspot.com",
    messagingSenderId: "600182491779",
    appId: "1:600182491779:web:a7cbbfbdaad1242101e9b6",
    measurementId: "G-KYXF27S5JW"
  };

  // Initialize Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // Handle form submission
  async function saveResume(event) {
    event.preventDefault();

    const name = document.getElementById("name").value;
    const email = document.getElementById("email").value;
    const skills = document.getElementById("skills").value;

    try {
      await db.collection("resumes").add({
        name,
        email,
        skills,
        createdAt: new Date()
      });
      alert("✅ Resume saved successfully!");
      event.target.reset();
    } catch (error) {
      console.error("Error saving resume:", error);
      alert("❌ Failed to save resume");
    }
  }
</script>
  <!-- 🩵 Step 2: Login / Signup Section -->
<div id="auth-section">
  <h3>Login / Signup</h3>
  <input type="email" id="authEmail" placeholder="Enter email" required>
  <input type="password" id="authPassword" placeholder="Enter password" required>
  <button onclick="signup()">Sign Up</button>
  <button onclick="login()">Login</button>
  <button onclick="logout()">Logout</button>
</div>

<!-- 🩶 Your Resume Form (already in your file) -->
<form id="resumeForm" onsubmit="saveResume(event)">
  <input type="text" id="name" placeholder="Full Name" required>
  <input type="text" id="title" placeholder="Job Title" required>
  <input type="email" id="email" placeholder="Email" required>
  <input type="text" id="phone" placeholder="Phone Number" required>
  <input type="text" id="linkedin" placeholder="LinkedIn Profile">
  <!-- rest of your fields -->
</form>
  <form id="resumeForm" onsubmit="saveResume(event)">
  <input type="text" id="name" placeholder="Full Name" required>
  <input type="text" id="title" placeholder="Job Title" required>
  <input type="email" id="email" placeholder="Email" required>
  <input type="text" id="phone" placeholder="Phone Number" required>
  <input type="text" id="linkedin" placeholder="LinkedIn Profile">
  <!-- and the rest of your form... -->
</form>
  <form onsubmit="saveResume(event)">
  <input id="name" placeholder="Your name" required><br>
  <input id="email" placeholder="Your email" required><br>
  <input id="skills" placeholder="Your skills" required><br>
  <button type="submit">Save Resume</button>
  </form>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBoIcJ6p-MlTgZaW6qTV9w3jPdwZvXlFaw",
      authDomain: "resume-builder-2dda8.firebaseapp.com",
      projectId: "resume-builder-2dda8",
      storageBucket: "resume-builder-2dda8.firebasestorage.app",
      messagingSenderId: "600182491779",
      appId: "1:600182491779:web:a7cbbfbdaad1242101e9b6",
      measurementId: "G-KYXF27S5JW"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    async function saveResume(event) {
      event.preventDefault();
      const name = document.getElementById("name").value;
      const email = document.getElementById("email").value;
      const skills = document.getElementById("skills").value;

      try {
        await db.collection("resumes").add({
          name,
          email,
          skills,
          createdAt: new Date()
        });
        alert("✅ Resume saved successfully!");
        event.target.reset();
      } catch (error) {
        console.error("Error saving resume:", error);
        alert("❌ Failed to save resume");
      }
    }
  </script>
</body>
</html>
<!-- 🩵 Firebase Backend -->
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore-compat.js"></script>

<script>
  // 🔥 Your Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyBoIcJ6p-MlTgZaW6qTV9w3jPdwZvXlFaw",
    authDomain: "resume-builder-2dda8.firebaseapp.com",
    projectId: "resume-builder-2dda8",
    storageBucket: "resume-builder-2dda8.firebasestorage.app",
    messagingSenderId: "600182491779",
    appId: "1:600182491779:web:a7cbbfbdaad1242101e9b6",
    measurementId: "G-KYXF27S5JW"
  };

  // 🚀 Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // 📝 Save Resume Function
  async function saveResume(event) {
    event.preventDefault(); // stop page refresh

    const name = document.getElementById("name").value;
    const email = document.getElementById("email").value;
    const title = document.getElementById("title").value;
    const phone = document.getElementById("phone").value;
    const linkedin = document.getElementById("linkedin").value;

    try {
      await db.collection("resumes").add({
        name,
        email,
        title,
        phone,
        linkedin,
        createdAt: new Date()
      });
      alert("✅ Resume saved successfully!");
      event.target.reset();
    } catch (error) {
      console.error("Error saving resume:", error);
      alert("❌ Failed to save resume. Check console for details.");
    }
  }
</script>
</body>
</html>
